import request, { handleDataProxy } from '../../src/service/network/request'
import requestOptions from 'Network/api'
import section, { MOVIE } from 'Index/config/section'

it('should fetch section data', async () => {
  expect.assertions(1)
  await expect(request({
    api: 'video.index.publication_ranking',
    params: {
      season_type: 2,
      day: 3
    }
  })).resolves.toBeTruthy()
}, 30000)

test('handle proxy data', () => {
  const originHost = '//i1.hdslb.com'
  const expectedHost = '/cdn'

  function generateTestCase (host) {
    return {
      code: 0,
      message: '0',
      ttl: 1,
      data: {
        pvdata: `${host}/bfs/videoshot/153392672.bin`,
        img_x_len: 10,
        img_y_len: 10,
        img_x_size: 160,
        img_y_size: 90,
        image: [
          `${host}/bfs/videoshot/153392672.jpg`,
          `${host}/bfs/videoshot/153392672-1.jpg`,
          `${host}/bfs/videoshot/153392672-2.jpg`,
          `${host}/bfs/videoshot/153392672-3.jpg`,
          `${host}/bfs/videoshot/153392672-4.jpg`,
          `${host}/bfs/videoshot/153392672-5.jpg`,
          `${host}/bfs/videoshot/153392672-6.jpg`
        ],
        index: [
          0,
          0,
          10,
          20,
          31,
          37,
          43,
          53,
          63,
          70,
          80,
          91,
          101,
          111,
          117,
          125,
          137,
          144,
          154,
          160,
          165,
          171,
          177,
          183,
          193,
          206,
          218,
          229,
          238,
          246,
          257,
          270,
          281,
          286,
          297,
          302,
          311,
          325,
          332,
          343,
          349,
          358,
          367,
          376,
          384,
          393,
          408,
          418,
          428,
          439,
          444,
          451,
          461,
          468,
          477,
          487,
          492,
          507,
          520,
          534,
          540,
          551,
          557,
          567,
          575,
          586,
          596,
          607,
          613,
          623,
          639,
          649,
          660,
          670,
          680,
          692,
          702,
          710,
          715,
          722,
          729,
          739,
          748,
          759,
          769,
          780,
          790,
          801,
          807,
          812,
          826,
          836,
          846,
          857,
          864,
          870,
          877,
          885,
          894,
          905,
          917,
          926,
          932,
          945,
          950,
          957,
          963,
          970,
          977,
          987,
          999,
          1009,
          1016,
          1028,
          1033,
          1043,
          1051,
          1058,
          1065,
          1071,
          1081,
          1087,
          1094,
          1102,
          1108,
          1116,
          1131,
          1141,
          1152,
          1157,
          1167,
          1178,
          1188,
          1195,
          1202,
          1208,
          1214,
          1220,
          1225,
          1231,
          1236,
          1242,
          1248,
          1254,
          1259,
          1264,
          1270,
          1278,
          1285,
          1290,
          1298,
          1305,
          1315,
          1327,
          1333,
          1348,
          1356,
          1361,
          1369,
          1380,
          1393,
          1400,
          1411,
          1417,
          1424,
          1431,
          1439,
          1445,
          1455,
          1466,
          1476,
          1483,
          1496,
          1502,
          1509,
          1521,
          1531,
          1536,
          1542,
          1548,
          1555,
          1563,
          1569,
          1579,
          1585,
          1593,
          1607,
          1622,
          1633,
          1640,
          1648,
          1663,
          1670,
          1681,
          1690,
          1699,
          1711,
          1716,
          1727,
          1736,
          1742,
          1752,
          1759,
          1767,
          1775,
          1780,
          1789,
          1795,
          1802,
          1815,
          1824,
          1834,
          1845,
          1850,
          1859,
          1870,
          1878,
          1887,
          1897,
          1907,
          1913,
          1921,
          1931,
          1942,
          1952,
          1959,
          1970,
          1980,
          1986,
          1992,
          1999,
          2005,
          2014,
          2021,
          2026,
          2035,
          2041,
          2047,
          2058,
          2064,
          2072,
          2084,
          2093,
          2102,
          2109,
          2118,
          2123,
          2129,
          2137,
          2145,
          2160,
          2170,
          2176,
          2187,
          2198,
          2208,
          2223,
          2231,
          2246,
          2252,
          2262,
          2271,
          2282,
          2292,
          2303,
          2309,
          2317,
          2325,
          2334,
          2340,
          2349,
          2360,
          2368,
          2383,
          2390,
          2395,
          2405,
          2418,
          2428,
          2434,
          2445,
          2457,
          2467,
          2473,
          2480,
          2490,
          2497,
          2504,
          2511,
          2517,
          2523,
          2529,
          2540,
          2554,
          2563,
          2568,
          2576,
          2587,
          2597,
          2603,
          2608,
          2621,
          2631,
          2637,
          2642,
          2655,
          2667,
          2682,
          2691,
          2699,
          2707,
          2718,
          2724,
          2730,
          2736,
          2742,
          2748,
          2757,
          2762,
          2770,
          2777,
          2791,
          2801,
          2813,
          2822,
          2835,
          2841,
          2847,
          2854,
          2859,
          2867,
          2872,
          2877,
          2884,
          2892,
          2898,
          2904,
          2910,
          2920,
          2926,
          2932,
          2943,
          2958,
          2963,
          2973,
          2978,
          2985,
          2995,
          3001,
          3011,
          3024,
          3037,
          3042,
          3050,
          3056,
          3070,
          3075,
          3086,
          3092,
          3098,
          3112,
          3123,
          3128,
          3139,
          3149,
          3154,
          3161,
          3169,
          3183,
          3191,
          3198,
          3212,
          3222,
          3233,
          3243,
          3253,
          3265,
          3275,
          3283,
          3297,
          3307,
          3317,
          3326,
          3337,
          3342,
          3350,
          3365,
          3375,
          3389,
          3400,
          3406,
          3417,
          3422,
          3435,
          3446,
          3456,
          3467,
          3480,
          3486,
          3496,
          3504,
          3509,
          3515,
          3522,
          3534,
          3549,
          3556,
          3562,
          3570,
          3579,
          3590,
          3597,
          3608,
          3615,
          3626,
          3637,
          3647,
          3657,
          3668,
          3678,
          3687,
          3695,
          3703,
          3710,
          3716,
          3730,
          3740,
          3752,
          3760,
          3767,
          3781,
          3793,
          3801,
          3811,
          3821,
          3832,
          3844,
          3854,
          3866,
          3877,
          3887,
          3893,
          3904,
          3912,
          3919,
          3931,
          3939,
          3953,
          3963,
          3971,
          3981,
          3994,
          4005,
          4015,
          4025,
          4034,
          4041,
          4056,
          4068,
          4077,
          4084,
          4092,
          4098,
          4110,
          4115,
          4123,
          4128,
          4133,
          4146,
          4155,
          4160,
          4170,
          4176,
          4182,
          4189,
          4197,
          4207,
          4214,
          4225,
          4231,
          4236,
          4242,
          4248,
          4258,
          4264,
          4273,
          4280,
          4293,
          4303,
          4310,
          4316,
          4322,
          4333,
          4339,
          4352,
          4357,
          4363,
          4371,
          4377,
          4383,
          4395,
          4400,
          4409,
          4416,
          4426,
          4436,
          4442,
          4448,
          4455,
          4467,
          4480,
          4491,
          4498,
          4510,
          4516,
          4529,
          4536,
          4547,
          4553,
          4568,
          4576,
          4581,
          4590,
          4596,
          4602,
          4616,
          4622,
          4637,
          4643,
          4651,
          4656,
          4669,
          4674,
          4681,
          4687,
          4694,
          4705,
          4715,
          4725,
          4731,
          4736,
          4743,
          4749,
          4760,
          4769,
          4778,
          4785,
          4795,
          4802,
          4810,
          4824,
          4830,
          4840,
          4849,
          4865,
          4877,
          4886,
          4896,
          4901,
          4912,
          4924,
          4933,
          4939,
          4951,
          4958,
          4968,
          4974,
          4984,
          4992,
          5002,
          5010,
          5025,
          5030,
          5036,
          5045,
          5054,
          5060,
          5071,
          5081,
          5091,
          5099,
          5104,
          5110,
          5116,
          5122,
          5129,
          5141,
          5151,
          5160,
          5167,
          5179,
          5191,
          5201,
          5213,
          5220,
          5226,
          5232,
          5246,
          5254,
          5260,
          5265,
          5271,
          5277,
          5287,
          5294,
          5300,
          5314,
          5326,
          5332,
          5338,
          5344,
          5351,
          5361,
          5369,
          5378,
          5385,
          5400,
          5410,
          5416,
          5423,
          5434,
          5448,
          5455,
          5461,
          5467,
          5477,
          5489,
          5495,
          5505,
          5511,
          5516,
          5522,
          5532,
          5542,
          5553,
          5563,
          5569,
          5575,
          5585,
          5593,
          5608,
          5618,
          5628,
          5638,
          5647,
          5654,
          5667,
          5676,
          5689,
          5696,
          5711,
          5718,
          5726,
          5735,
          5744,
          5752,
          5761,
          5770,
          5780,
          5790,
          5801,
          5811,
          5822,
          5832,
          5843,
          5853,
          5863,
          5874,
          5884,
          5895,
          5905,
          5916,
          5926,
          5936,
          5947,
          5957
        ]
      }
    }
  }

  expect(handleDataProxy(generateTestCase(originHost)))
    .toEqual(generateTestCase(expectedHost))
})

it('should fetch rank list', async () => {
  expect.assertions(1)
  await expect(request({ api: 'video.index.section_ranking', params: { rid: 188, day: 3, original: 0 } })).resolves
    .toBeTruthy()
}, 30000)

it('should generate request options', function () {
  expect(requestOptions('video.index.publication_ranking', {
    season_type: 2,
    day: 3
  })).toEqual({
    url: 'https://api.bilibili.com/pgc/web/rank/list',
    method: 'GET',
    params: {
      season_type: 2,
      day: 3
    }
  })
})

it('should convert timeline data format', async function () {
  expect.assertions(1)
  await expect(request({ api: 'video.index.anime_timeline', params: { season_type: 1 } })).resolves
    .toBeTruthy()
})

it('should fetch manga data', async function () {
  expect.assertions(1)
  await expect(request({
    api: 'manga.index.recommend_card',
    data: {
      type: 1,
      page_size: 12,
      page_num: 1
    }
  })).resolves.toBeTruthy()
}, 30000)
